<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>MPI之环境配置 - PzNotes - Learning and Sharing</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="pzhang" />
  <meta name="description" content="  很久之前挖的坑，现在慢慢填坑中……
 作为 MPI 系列学习笔记的开始，本文介绍如何在服务器上配置 MPI 环境。
" />

  <meta name="keywords" content="Geophysics, Computer Vision, Machine Learning" />






<meta name="generator" content="Hugo 0.69.2" />


<link rel="canonical" href="https://whu-pzhang.github.io/mpi-intro/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">







<link href="/dist/even.min.css?v=3.1.1" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="MPI之环境配置" />
<meta property="og:description" content="
 很久之前挖的坑，现在慢慢填坑中……

作为 MPI 系列学习笔记的开始，本文介绍如何在服务器上配置 MPI 环境。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://whu-pzhang.github.io/mpi-intro/" />
<meta property="article:published_time" content="2018-04-08T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-04-08T00:00:00+00:00" />
<meta itemprop="name" content="MPI之环境配置">
<meta itemprop="description" content="
 很久之前挖的坑，现在慢慢填坑中……

作为 MPI 系列学习笔记的开始，本文介绍如何在服务器上配置 MPI 环境。">
<meta itemprop="datePublished" content="2018-04-08T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-04-08T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="857">



<meta itemprop="keywords" content="MPI,高性能计算," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MPI之环境配置"/>
<meta name="twitter:description" content="
 很久之前挖的坑，现在慢慢填坑中……

作为 MPI 系列学习笔记的开始，本文介绍如何在服务器上配置 MPI 环境。"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">PzNotes</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/notes/">
        <li class="mobile-menu-item">Notes</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">PzNotes</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/notes/">Notes</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">MPI之环境配置</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-04-08 </span>
        <div class="post-category">
            
              <a href="/categories/programming/"> Programming </a>
            
          </div>
        <span class="more-meta"> 约 857 字 </span>
        <span class="more-meta"> 预计阅读 2 分钟 </span>
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#mpi-安装">MPI 安装</a></li>
    <li><a href="#集群上的配置">集群上的配置</a></li>
    <li><a href="#mpi_hello">MPI_Hello</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <blockquote>
<p> 很久之前挖的坑，现在慢慢填坑中……</p>
</blockquote>
<p>作为 MPI 系列学习笔记的开始，本文介绍如何在服务器上配置 MPI 环境。</p>
<h2 id="mpi-安装">MPI 安装</h2>
<p>安装部分略过不谈。自行下载源码编译或者从 Linux 发行版仓库安装均可。</p>
<p>安装完成后</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ mpicc --showme
llvm-clang -I/usr/local/Cellar/open-mpi/3.0.0_2/include -L/usr/local/opt/libevent/lib -L/usr/local/Cellar/open-mpi/3.0.0_2/lib -lmpi
</code></pre></div><h2 id="集群上的配置">集群上的配置</h2>
<p>MPI 通常是运行在多节点服务器上，单机并行直接用 OpenMP 可能更为方便。</p>
<p>多节点上的 MPI 程序需要在不同的计算机之间进行了通信，那么就需要知道每个节点的 IP 地址，为了方便输入，可以给每个节点取一个名字，这样就不用去记各自的 IP 地址了。<code>hosts</code> 文件保存着 IP 和名字的映射关系。这里进行设置的是你执行计算的节点，即主节点（Client）。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat /etc/hosts
<span style="color:#75715e"># Do not remove the following line, or various programs</span>
<span style="color:#75715e"># that require network functionality will fail.</span>
127.0.0.1	node10	localhost
::1		node10  localhost6
192.168.0.1 node1
192.168.0.2 node2
192.168.0.3 node3
192.168.0.4 node4
192.168.0.5 node5
192.168.0.6 node6
192.168.0.7 node7
192.168.0.8 node8
192.168.0.9 node9
192.168.0.10 node10
192.168.0.11 node11
192.168.0.12 node12
192.168.0.13 node13
192.168.0.14 node14
192.168.0.15 node15
192.168.0.16 node16
192.168.0.17 node17
</code></pre></div><p>上述输出为在所里曙光超算上控制节点(主节点)的输出。</p>
<p>如此设置后即可利用 <code>ssh username@hostname</code> 来登录不同的节点了，这个命令会让你输入用户密码，为了使得节点见通信不需要密码，可以生成公共秘钥加入主节点的 <code>authorized_keys</code> 中。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ssh-keygen -t dsa
</code></pre></div><p>一系列回车(默认值)后，将生成的秘钥拷贝到各个子节点即可。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat .ssh/id_dsa.pub | ssh b@B <span style="color:#e6db74">&#39;cat &gt;&gt; .ssh/authorized_keys&#39;</span>
b@B<span style="color:#960050;background-color:#1e0010">&#39;</span>s password:
</code></pre></div><p>现在各个节点可以进行通信，但是还需要有一个共享的存储数据的文件夹，使得所有的节点均可以访问。</p>
<p>由于所里超算是共享硬盘的，这一步暂时不管。</p>
<p>至此，MPI 的运行环境便已经搭建完毕！下面运行一个简单的程序测试一下。</p>
<h2 id="mpi_hello">MPI_Hello</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;mpi.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>)
{
    MPI_Init(NULL, NULL);

    <span style="color:#66d9ef">int</span> rank, size, len;
    <span style="color:#66d9ef">char</span> hostName[MPI_MAX_PROCESSOR_NAME];
    MPI_Get_processor_name(hostName, <span style="color:#f92672">&amp;</span>len);
    MPI_Comm_size(MPI_COMM_WORLD, <span style="color:#f92672">&amp;</span>size);
    MPI_Comm_rank(MPI_COMM_WORLD, <span style="color:#f92672">&amp;</span>rank);

    printf(<span style="color:#e6db74">&#34;Number of task=%d, My rank=%d Running on %s.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, size, rank, hostName);

    MPI_Finalize();
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p>编译链接：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mpicc -std<span style="color:#f92672">=</span>c99 -Wall mpi_hello.c -o mpi_hello
</code></pre></div><p>运行时，可以在命令行指定在哪些节点上运行，也可以通过 <code>hostfile</code> 来指定。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mpirun -np <span style="color:#ae81ff">8</span> --hosts node1,node2,node3,node4 ./mpi_hello
Number of task<span style="color:#f92672">=</span>8, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> Running on node3.
Number of task<span style="color:#f92672">=</span>8, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span> Running on node3.
Number of task<span style="color:#f92672">=</span>8, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span> Running on node4.
Number of task<span style="color:#f92672">=</span>8, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span> Running on node1.
Number of task<span style="color:#f92672">=</span>8, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> Running on node2.
Number of task<span style="color:#f92672">=</span>8, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> Running on node2.
Number of task<span style="color:#f92672">=</span>8, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> Running on node4.
Number of task<span style="color:#f92672">=</span>8, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> Running on node1.
$ cat host.txt
node3:4
node4:4
node5:4
node6:4
$ mpirun -np <span style="color:#ae81ff">16</span> --hostfile host.txt ./mpi_hello
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span> Running on node5.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">14</span> Running on node6.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">13</span> Running on node6.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">12</span> Running on node6.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">15</span> Running on node6.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> Running on node3.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> Running on node3.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span> Running on node4.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> Running on node3.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> Running on node4.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span> Running on node4.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span> Running on node4.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">9</span> Running on node5.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> Running on node3.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span> Running on node5.
Number of task<span style="color:#f92672">=</span>16, My rank<span style="color:#f92672">=</span><span style="color:#ae81ff">11</span> Running on node5.
</code></pre></div><h2 id="参考">参考</h2>
<ul>
<li><a href="http://mpitutorial.com/tutorials/running-an-mpi-cluster-within-a-lan/">Running an MPI cluster within a Lan</a></li>
</ul>
    </div>

    
    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">pzhang</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">2018-04-08</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a></span>
  </p>
</div>

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/mpi/">MPI</a>
          
          <a href="/tags/%E9%AB%98%E6%80%A7%E8%83%BD%E8%AE%A1%E7%AE%97/">高性能计算</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/kalman-filter/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">卡尔曼滤波</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/install-opencv-on-macos/">
            <span class="next-text nav-default">macOS 安装 OpenCV</span>
            <span class="prev-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:pzhang.omega@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/whu-pzhang" class="iconfont icon-github" title="github"></a>
  <a href="https://whu-pzhang.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    
      2014 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">whu-pzhang</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script><script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>
<script type="text/javascript" src="/dist/even.min.js?v=3.1.1"></script>








</body>
</html>
